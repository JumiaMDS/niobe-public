<link rel="import" href="../lib/request-connection.html">
<link rel="import" href="../lib/dash-access-control-behavior.html">

<script>
  'use strict';

  function ModuleElementBehavior(superClass) {
    return class extends DashAccessControlBehavior(superClass) {
      static get properties() {
        return {
          module: String,
          pageType: {
            type: String,
            value: 'list'
          },
          namespace: String,
          modelElement: HTMLElement,
          requestConnections: {
            type: Object,
            value: {}
          },
          accessControl: {
            type: Object,
          },
          actions: Array,
          permissions: {
            type: Array
          },
          userActions: {
            type: Array
          }
        }
      }

      static get observers() {
        return [
          '_getUserActions(permissions, accessControl, actions)',
        ];
      }

      _getUserActions(permissions, accessControl, actions) {
        this.userActions = super._getAvailableActions(permissions, accessControl, actions);
      }

      _setConnections () {
        for (var ns in Dash.connections) {
          let url = Dash.connections[ns].url;
          let headers = Dash.connections[ns].headers;

          this.requestConnections[ns] = new RequestConnection(url, headers);
        }
      }

      constructor () {
        super();
        this._setConnections();
      }

      ready () {
        super.ready();
        Polymer.RenderStatus.afterNextRender(this, function () {
          this.modelElement = this.shadowRoot.querySelector(this.model);
          this.modelElement.connection = this.requestConnections[this.namespace];
          this.modelElement.addEventListener('model-response-changed', this.onResponseChanged.bind(this));
          if (this.pageType === 'list') {
            this.getList();
          } else if (this.pageType === 'form') {
            this.getForm();
          }
        });
      }

      onResponseChanged (e) {

      }

      getList () {
        this.modelElement.search();
      }

      getForm () {

      }
    }
  }

</script>