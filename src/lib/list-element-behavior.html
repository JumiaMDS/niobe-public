<link rel="import" href="../configs/connections.html">
<link rel="import" href="../lib/request-connection.html">

<script>
  'use strict';

  function ListElementBehavior(superClass) {
    return class extends superClass {
      static get properties() {
        return {
          response: {
            type: Object,
            value: {},
            observer: '_responseChanged'
          },
          columns: {
            type: Array,
            value: []
          },
          actions: {
            type: Array,
            value: []
          },
          requestConnections: {
            type: Object,
            value: {}
          },
          failure: {
            type: Boolean,
            value: false
          }
        }
      }

      _responseChanged (response) {
        this.dispatchEvent(new CustomEvent('dash-response-changed', {detail: response}));
      }

      _setFailure (value) {
        this.failure = value;
      }

      _setConnections () {
        for (var namespace in Dash.connections) {
          let url = Dash.connections[namespace].url;
          let headers = Dash.connections[namespace].headers;

          this.requestConnections[namespace] = new RequestConnection(url, headers);
        }
      }

      constructor () {
        super();
        this._setConnections();
      }

      fetch (namespace, request) {
        this.requestConnections[namespace].fetch(request);
      }

      ready () {
        super.ready();
        var _self = this;
        this.fetch('seraph',{
          url: '/authorization/groups',
          verb: 'GET',
          onLoad(e) {
            _self.set('response', JSON.parse(e.target.responseText));
          },
          onError(e) {
            _self._setFailure(true);
          }
        });
      }
    }
  }

</script>