<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../bower_components/paper-datatable-api/paper-datatable-api-column.html">
<link rel="import" href="../../bower_components/paper-datatable-api/paper-datatable-api.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../lib/cell-element-behavior.html">
<link rel="import" href="dash-list-cell-content.html">

<link rel="import" href="../my-icons.html">
<link rel="import" href="../shared-styles.html">

<dom-module id="dash-list">
  <template>
    <style include="shared-styles">
       :host {
          display: block;
          --paper-datatable-api-custom-td: {
            text-align:right;
            width: 150px;
          }
          --paper-datatable-api-header: {
            font-weight: 400;
            font-size: 14px;
          }
        }
        paper-datatable-api {
          --paper-datatable-api-checked-checkbox-color: var(--primary-color);
          --paper-datatable-api-tr-hover-background-color: var(--paper-grey-200);
          --paper-datatable-api-tr-odd-background-color: var(--paper-grey-100);
        }
        .header {
          padding: 35px 16px 16px;
          border-bottom: solid 1px var(--paper-blue-grey-200);
          position: relative;
        }

        .card-content {
          background-color: #FFF;
          color: #000;
          border-left: solid 4px var(--paper-blue-800);
        }
        
        h2 {
          margin: 0;
          font-weight: 400;
        }
        h2 iron-icon {
          --iron-icon-width: 48px;
          --iron-icon-height: 48px;
          padding-right: 16px;
        }
        paper-fab.blue {
        --paper-fab-background: var(--paper-light-blue-300);
        --paper-fab-keyboard-focus-background: var(--paper-light-blue-900);
        position: absolute;
        top: -32px;
        right: 32px;
      }
    </style>

    <paper-material elevation="2">
      <div class="card-content">
        <div class$="header [[headingStyle]]">
          <h2><iron-icon icon="[[icon]]"></iron-icon>[[heading]]</h2>
          <template is="dom-if" if="[[actions.create]]">
            <paper-fab on-tap="_notifyGoToCreate" class="blue" icon="my-icons:playlist-add"></paper-fab>
          </template>
        </div>
        <paper-datatable-api 
          data="[[items]]" 
          page="{{page}}"
          size="{{size}}"
          selected-rows="{{selectedRows}}"
          available-size="[2, 4]"
          total-elements="[[totalItems]]"
          total-pages="[[totalPages]]"
          selectable-data-key="[[key]]"
          paginate 
          selectable>
          <template is="dom-repeat" items="[[columns]]" as="column">
            <paper-datatable-api-column 
              header="[[column.header]]" 
              draggable-column="[[_isDraggable(column)]]"
              sortable="[[_isData(column.type)]]"
              td-custom-style="[[!_isDraggable(column)]]"
              property="[[column.index]]">
              <template>
                <template is="dom-if" if="[[!_isActions(column.type)]]">
                  <dash-list-cell-content 
                    column="[[column]]">[[value]]</dash-list-cell-content>
                </template>
                <template is="dom-if" if="[[_isActions(column.type)]]">
                  <dash-list-cell-content 
                    key="[[value]]"
                    actions="[[_columnActions]]"></dash-list-cell-content>
                </template>
              </template>
            </paper-datatable-api-column>
          </template>
        </paper-datatable-api>

      </div>
    </paper-material>

  </template>

  <script>
    /**
     * `dash-list` Description
     *
     * @summary ShortDescription.
     * @customElement
     * @polymer
     * @extends {Polymer.Element}
     */
    class DashList extends CellElementBehavior(Polymer.Element) {
      /**
       * String providing the tag name to register the element under.
       */
      static get is() {
        return 'dash-list';
      }

      /**
       * Object describing property-related metadata used by Polymer features
       */
      static get properties() {
        return {
          _columnActions: {
            type: Array,
            value: []
          },
          heading: String,
          icon: String,
          headingStyle: String,
          key: String,
          columns: {
            type: Array,
            value: []
          },
          actions: {
            type: Array,
            observer: '_actionsChanged'
          },
          items: {
            type: Array,
            value: []
          },
          totalItems: Number,
          totalPages: Number,
          perPage: {
            type: Number,
            value: 10
          },
          page: Number,
          size: {
            type: Number,
            value: 4
          },
          selectedRows: {
            type: Array,
            value: [],
          },
          _totalFetched: Number
        };
      }

      _isDraggable(column) {
        return this._isData(column.type) ;
      }

      _actionsChanged (actions) {
        if (actions) {
          let _cActions = [];
          for (let action in actions) {
            if (action !== 'create') {
              _cActions.push({
                type: action,
              });
            }
          }
          this.set('_columnActions', _cActions);
        }
      }

      _notifyCTA (action) {
        this.dispatchEvent(new CustomEvent('dash-list-exec', {
          bubbles: true,
          composed: true,
          detail: action
        }));
      }

      _notifyGoToCreate (e) {
        this._notifyCTA({
            type: 'create',
            key: null
        });
      }

      /**
       * Instance of the element is created/upgraded. Use: initializing state,
       * set up event listeners, create shadow dom.
       * @constructor
       */
      constructor() {
        super();
      }

      /**
       * Use for one-time configuration of your component after local DOM is initialized. 
       */
      ready() {
        super.ready();
        this.addEventListener('dash-list-cta', function (e) {
          this._notifyCTA(e.detail);
        }.bind(this));
      }

    }

    window.customElements.define(DashList.is, DashList);
  </script>
</dom-module>