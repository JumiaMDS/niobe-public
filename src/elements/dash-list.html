<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/paper-datatable-api/paper-datatable-api-column.html">
<link rel="import" href="../../bower_components/paper-datatable-api/paper-datatable-api.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/iron-icons/social-icons.html">

<link rel="import" href="../lib/cell-element-behavior.html">
<link rel="import" href="../lib/list-element-behavior.html">
<link rel="import" href="dash-list-cell-content.html">

<link rel="import" href="../shared-styles.html">

<dom-module id="dash-list">
  <template>
    <style include="shared-styles">
       :host {
          display: block;
          --paper-datatable-api-custom-td: {
            width: 100px;
            text-align:center;
          }
        }
        paper-datatable-api {
          --paper-datatable-api-checked-checkbox-color: var(--primary-color);
          --paper-datatable-api-tr-hover-background-color: var(--paper-grey-200);
          --paper-datatable-api-tr-odd-background-color: var(--paper-grey-100);
        }
        .header {
          padding: 32px 16px 16px;
        }
        .yellow {
          background-color: var(--paper-yellow-600);
          color: #FFF;
        }

        .blue-grey {
          background-color: var(--paper-blue-grey-400);
          color: #FFF;
        }

        .card-content {
          background-color: #FFF;
          color: #000;
        }
        paper-material {
          display: block;
          margin: 16px;
        }
        hr {
          border: none;
          height: 1px;
          background-color: var(--paper-blue-grey-200);
          margin: 0;
        }
        h2 {
          margin: 0;
        }
        h2 iron-icon {
          --iron-icon-width: 48px;
          --iron-icon-height: 48px;
          padding-right: 16px;
        }
    </style>

    <paper-material elevation="2">
      <div class="card-content">
        <div class$="header [[headingStyle]]">
          <h2><iron-icon icon="[[icon]]"></iron-icon>[[heading]]</h2>
        </div>
        <hr/>
        <paper-datatable-api 
          data="[[items]]" 
          page="{{page}}"
          size="{{size}}"
          selected-rows="{{selectedRows}}"
          available-size="[2, 4]"
          total-elements="[[totalItems]]"
          total-pages="[[totalPages]]"
          selectable-data-key="[[key]]"
          paginate 
          selectable>
          <template is="dom-repeat" items="[[columns]]" as="column">
            <paper-datatable-api-column 
              header="[[column.header]]" 
              draggable-column="[[_isDraggable(column)]]"
              sortable="[[_isData(column.type)]]"
              td-custom-style="[[!_isDraggable(column)]]"
              property="[[column.index]]">
              <template>
                <dash-list-cell-content column="[[column]]">[[value]]</dash-list-cell-content>
              </template>
            </paper-datatable-api-column>
          </template>
        </paper-datatable-api>

      </div>
    </paper-material>

  </template>

  <script>
    /**
         * `dash-list` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
    class DashList extends ListElementBehavior(CellElementBehavior(Polymer.Element)) {
      /**
       * String providing the tag name to register the element under.
       */
      static get is() {
        return 'dash-list';
      }

      /**
       * Object describing property-related metadata used by Polymer features
       */
      static get properties() {
        return {
          heading: String,
          icon: String,
          headingStyle: String,
          key: String,
          columns: {
            type: Array,
            value: []
          },
          items: {
            type: Array,
            value: []
          },
          totalItems: Number,
          totalPages: Number,
          perPage: {
            type: Number,
            value: 10
          },
          page: Number,
          size: {
            type: Number,
            value: 4
          },
          selectedRows: {
            type: Array,
            value: [],
          },
          _totalFetched: Number
        };
      }

      _isDraggable(column) {
        return this._isData(column.type) && column.index != this.key;
      }

      /**
       * Instance of the element is created/upgraded. Use: initializing state,
       * set up event listeners, create shadow dom.
       * @constructor
       */
      constructor() {
        super();
      }

      /**
       * Use for one-time configuration of your component after local DOM is initialized. 
       */
      ready() {
        super.ready();
        this.addEventListener('dash-response-changed', (e) => {
          this.set('items', e.detail.response.groups);
          this.totalItems = e.detail.response.total;
          this._totalFetched = this.items.length;
          this.totalPages = Math.ceil(this.totalItems/this.perPage);

          this.page=0;
        })
      }

    }

    window.customElements.define(DashList.is, DashList);
  </script>
</dom-module>